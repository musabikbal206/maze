<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Mazemazing</title>
    <link rel="manifest" href="./manifest.json">
    
    <!-- PWA Settings -->
    <meta name="theme-color" content="#020617">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Three.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <!-- Phosphor Icons -->
    <script src="https://unpkg.com/@phosphor-icons/web"></script>

    <link rel="stylesheet" href="style.css">

</head>
<body>

    <!-- Game Layer -->
    <div id="game-layer">
        <canvas id="c3d"></canvas>
        <canvas id="c2d" style="display:none; background:#020617;"></canvas>
    </div>

    <!-- Timer -->
    <div id="game-timer">00:00</div>

    <!-- Joystick (Game Only) -->
    <div id="controls-ui">
        <div class="stick-zone" id="stick-zone">
            <div class="stick-base">
                <div class="stick-thumb" id="stick-thumb"></div>
            </div>
            <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 pointer-events-none opacity-30 text-white text-2xl">
                <i class="ph ph-arrows-out-cardinal"></i>
            </div>
        </div>
    </div>

    <!-- Desktop Hint -->
    <div id="controls-hint" class="ui-screen hidden md:flex justify-end items-end p-8 z-10 pointer-events-none">
        <div class="bg-slate-900/80 backdrop-blur p-4 rounded-xl border border-white/10 text-slate-400 text-sm font-mono flex flex-col gap-2">
            <div class="flex items-center gap-4"><span class="bg-slate-700 px-2 rounded text-white">WASD</span> <span data-i18n="hint_move">Move</span></div>
            <div class="flex items-center gap-4"><span class="bg-slate-700 px-2 rounded text-white">M</span> <span data-i18n="hint_map">Map</span></div>
            <div class="flex items-center gap-4"><span class="bg-slate-700 px-2 rounded text-white">V</span> <span data-i18n="hint_view">View</span></div>
            <div class="flex items-center gap-4"><span class="bg-slate-700 px-2 rounded text-white">ESC</span> <span data-i18n="main_menu">Main Menu</span></div>
        </div>
    </div>

    <!-- Main Menu -->
    <div id="screen-menu" class="ui-screen interactive bg-slate-950/95 flex items-center justify-center overflow-y-auto transition-colors duration-500">
        <!-- Top Right Controls -->
        <div class="absolute top-6 right-6 flex gap-2 z-50">
            <!-- Theme Toggle -->
            <button onclick="Game.toggleTheme()" class="bg-slate-800 text-yellow-400 hover:text-white px-3 py-1 rounded-lg font-bold text-lg border border-slate-700 flex items-center justify-center transition hover:bg-slate-700 shadow-lg" title="Toggle Theme">
                <i id="icon-theme" class="ph ph-moon"></i>
            </button>
            <!-- Language Toggle -->
            <button onclick="Lang.toggle()" class="bg-slate-800 text-slate-400 hover:text-white px-3 py-1 rounded-lg font-bold text-xs border border-slate-700 flex items-center gap-2 transition hover:bg-slate-700 shadow-lg">
                <i class="ph ph-globe"></i> <span id="lbl-lang">EN</span>
            </button>
        </div>

        <div class="text-center max-w-md w-full p-6 my-auto relative flex flex-col items-center">
            <!-- Title Section - Adjusted for visibility -->
            <div class="mb-12 mt-8 md:mt-0 relative z-10">
                <h1 class="text-6xl md:text-7xl font-black text-transparent bg-clip-text bg-gradient-to-r from-cyan-400 to-blue-600 mb-2 py-4 filter drop-shadow-lg tracking-tight leading-tight">MAZEMAZING</h1>
                <!-- Subtitle Removed per request -->
            </div>

            <!-- Mode Selection -->
            <div class="flex gap-2 mb-8 justify-center w-full">
                <button onclick="Game.setMode('standard')" id="mode-standard" class="mode-btn active px-4 py-3 rounded-xl font-bold text-xs transition flex flex-col items-center gap-1 w-24 shadow-md">
                    <i class="ph ph-person-simple-walk text-xl"></i> STANDARD
                </button>
                <button onclick="Game.setMode('ghost')" id="mode-ghost" class="mode-btn px-4 py-3 rounded-xl font-bold text-xs transition flex flex-col items-center gap-1 w-24 shadow-md">
                    <i class="ph ph-ghost text-xl"></i> GHOST
                </button>
                <button onclick="Game.setMode('time')" id="mode-time" class="mode-btn px-4 py-3 rounded-xl font-bold text-xs transition flex flex-col items-center gap-1 w-24 shadow-md">
                    <i class="ph ph-timer text-xl"></i> TIMED
                </button>
            </div>

            <div class="space-y-3 w-full" id="menu-list">
                <button data-nav="true" onclick="Game.start('easy')" class="w-full bg-emerald-600 hover:bg-emerald-500 text-white py-4 rounded-xl font-bold shadow-lg transition transform active:scale-95 border-2 border-transparent" data-i18n="easy">Easy (10x10)</button>
                <button data-nav="true" onclick="Game.start('medium')" class="w-full bg-amber-600 hover:bg-amber-500 text-white py-4 rounded-xl font-bold shadow-lg transition transform active:scale-95 border-2 border-transparent" data-i18n="medium">Medium (25x25)</button>
                <button data-nav="true" onclick="Game.start('hard')" class="w-full bg-rose-600 hover:bg-rose-500 text-white py-4 rounded-xl font-bold shadow-lg transition transform active:scale-95 border-2 border-transparent" data-i18n="hard">Hard (50x50)</button>
                <button data-nav="true" onclick="Game.start('extreme')" class="w-full bg-purple-700 hover:bg-purple-600 text-white py-4 rounded-xl font-bold shadow-lg transition transform active:scale-95 border-2 border-transparent ring-1 ring-purple-400/50" data-i18n="extreme">Extreme (100x100)</button>
                
                <div class="relative py-6 flex items-center">
                    <div class="flex-grow border-t border-slate-700"></div>
                    <span class="flex-shrink-0 mx-4 text-slate-500 text-xs font-bold" data-i18n="code_label">OR USE A CODE</span>
                    <div class="flex-grow border-t border-slate-700"></div>
                </div>

                <div class="bg-slate-900/50 p-3 rounded-xl border border-slate-800 space-y-2 menu-input-group transition-colors">
                    <div class="flex gap-2">
                        <input id="inp-code" type="text" placeholder="CODE" class="input-glow flex-1 bg-slate-950 border border-slate-700 text-cyan-400 font-mono font-bold text-center rounded-lg px-2 h-10 focus:outline-none focus:border-cyan-500 transition placeholder-slate-600 uppercase">
                        <button onclick="Utils.randomCode('inp-code')" class="w-10 h-10 bg-slate-800 text-slate-300 hover:text-white rounded-lg flex items-center justify-center transition shadow-sm border border-transparent" title="Random Code">
                            <i class="ph ph-dice-five text-xl"></i>
                        </button>
                    </div>
                    
                    <div class="flex gap-2">
                         <select id="inp-size" class="h-10 bg-slate-950 text-slate-300 border border-slate-700 rounded-lg px-2 text-xs font-bold outline-none focus:border-cyan-500 flex-1">
                             <option value="11">SMALL (10x10)</option>
                             <option value="25" selected>MEDIUM (25x25)</option>
                             <option value="51">LARGE (50x50)</option>
                             <option value="101">EXTREME (100x100)</option>
                         </select>
                         <button onclick="Game.start('code')" class="h-10 px-4 bg-cyan-700 hover:bg-cyan-600 text-white rounded-lg font-bold shadow-lg transition transform active:scale-95 text-sm border-transparent" data-i18n="load_map">
                             LOAD
                         </button>
                    </div>
                </div>

                <div class="h-4"></div>
                <button data-nav="true" onclick="Editor.open()" class="w-full bg-slate-800 hover:bg-slate-700 text-slate-300 py-3 rounded-xl font-bold shadow-lg flex items-center justify-center gap-2 border-2 border-transparent transition menu-editor-btn">
                    <i class="ph ph-pencil-simple"></i> <span data-i18n="map_editor">Map Editor</span>
                </button>
                
                <div class="flex justify-center mt-4">
                    <button onclick="Sfx.toggle()" class="text-slate-500 hover:text-slate-300 transition flex items-center gap-2 text-sm font-bold">
                        <i id="icon-sound" class="ph ph-speaker-high text-lg"></i> <span id="txt-sound" data-i18n="sound_on">Sound On</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Game UI -->
    <div id="screen-game" class="ui-screen hidden justify-between p-4 z-40">
        <div class="flex justify-between w-full interactive items-start">
            <!-- Top Left: Exit & Code Info -->
            <div class="flex flex-col md:flex-row md:items-center gap-2 md:gap-4">
                <button onclick="Game.quit()" class="bg-red-950/80 backdrop-blur text-red-200 border border-red-900/50 px-3 py-2 rounded-lg font-bold shadow-lg text-sm transition active:scale-95 flex items-center gap-2 btn-game-ui w-fit">
                    <i class="ph ph-sign-out text-lg"></i><span data-i18n="exit">Exit</span>
                </button>
                 <div id="ui-code-display" class="hidden bg-slate-900/60 backdrop-blur text-slate-400 border border-slate-800 px-3 py-2 rounded-lg text-xs font-mono shadow-md whitespace-nowrap w-fit">
                    <span class="opacity-50 mr-1">MAP:</span> <span class="text-cyan-400 font-bold tracking-wider" id="ui-code-val">---</span>
                </div>
            </div>

            <!-- Top Right: View Controls & Minimap -->
            <div class="flex flex-col items-end gap-2">
                <!-- Toggle Row -->
                <div class="flex gap-2">
                    <!-- 2D/3D Toggle -->
                    <button onclick="Game.toggleDimension()" class="bg-slate-900/80 backdrop-blur text-cyan-400 border border-cyan-900/50 px-3 py-2 rounded-lg font-bold shadow-lg flex items-center gap-2 text-sm transition active:scale-95 btn-game-ui">
                        <i id="icon-dim" class="ph ph-cube text-lg"></i> <span id="lbl-dim" data-i18n="view_3d">3D View</span> <span class="key-badge hidden md:inline">M</span>
                    </button>
                    <!-- POV Toggle (1st/3rd) -->
                    <button id="btn-pov" onclick="Game.toggleCamera()" class="bg-slate-900/80 backdrop-blur text-emerald-400 border border-emerald-900/50 px-3 py-2 rounded-lg font-bold shadow-lg flex items-center gap-2 text-sm transition active:scale-95 btn-game-ui">
                        <i id="icon-pov" class="ph ph-person text-lg"></i> <span id="lbl-pov" data-i18n="view_3rd">3rd Person</span> <span class="key-badge hidden md:inline">V</span>
                    </button>
                </div>

                <div id="minimap-wrapper">
                    <canvas id="minimap"></canvas>
                </div>
            </div>
        </div>
    </div>

    <!-- Editor UI -->
    <div id="screen-editor" class="ui-screen hidden bg-slate-950 z-50 flex-col interactive font-sans transition-colors duration-300">
        <!-- Header -->
        <div class="h-16 bg-slate-900 border-b border-slate-800 flex items-center justify-between px-4 md:px-6 shrink-0 shadow-lg z-20 transition-colors duration-300" id="editor-header">
            <div class="flex items-center gap-3">
                <div class="w-8 h-8 bg-cyan-600 rounded-lg flex items-center justify-center text-white shadow-cyan-500/20 shadow-lg hidden md:flex">
                    <i class="ph ph-pencil-simple-line text-xl"></i>
                </div>
                <div>
                    <h2 class="font-bold text-slate-100 text-lg leading-tight flex items-center gap-2"><i class="ph ph-pencil-simple-line md:hidden text-cyan-400"></i> <span data-i18n="map_editor">Map Editor</span></h2>
                    <p class="text-xs text-slate-500 font-mono hidden md:block">DESIGN MODE</p>
                </div>
            </div>
            <div class="flex gap-3">
                <button onclick="Editor.close()" class="bg-slate-800 hover:bg-slate-700 text-slate-300 hover:text-white px-4 py-2 rounded-lg font-bold text-sm transition border border-slate-700" id="btn-editor-back">
                    <span data-i18n="back">Back</span>
                </button>
                <button onclick="Game.start('custom')" class="bg-green-600 hover:bg-green-500 text-white px-5 py-2 rounded-lg font-bold shadow-lg flex items-center gap-2 text-sm transition transform active:scale-95">
                    <i class="ph ph-play-circle text-lg"></i> <span data-i18n="play">Play</span>
                </button>
            </div>
        </div>

        <div class="flex flex-1 overflow-hidden flex-col-reverse md:flex-row relative">
            
            <!-- Sidebar -->
            <div class="w-full md:w-72 bg-slate-900 border-t md:border-t-0 md:border-r border-slate-800 flex flex-col z-10 shadow-xl overflow-y-auto custom-scroll shrink-0 max-h-[40vh] md:max-h-full transition-colors duration-300" id="editor-sidebar">
                <div class="p-2 md:p-4 grid grid-cols-2 md:flex md:flex-col gap-2 md:space-y-6">
                    
                    <div class="space-y-2 md:space-y-6 flex flex-col">
                        <!-- Tools Section -->
                        <div class="space-y-1 md:space-y-2">
                            <h3 class="text-[10px] md:text-xs font-bold text-slate-500 uppercase tracking-wider hidden md:block">Mode</h3>
                            <div class="flex bg-slate-950 p-1 rounded-lg border border-slate-800 transition-colors" id="editor-tools-bg">
                                <button onclick="Editor.setMode('draw')" id="btn-mode-draw" class="flex-1 py-1 md:py-2 rounded-md transition flex justify-center items-center text-[10px] md:text-xs font-bold gap-2">
                                    <i class="ph ph-pencil-simple text-sm md:text-lg"></i> <span class="hidden sm:inline" data-i18n="draw">DRAW</span>
                                </button>
                                <button onclick="Editor.setMode('pan')" id="btn-mode-pan" class="flex-1 py-1 md:py-2 rounded-md transition flex justify-center items-center text-[10px] md:text-xs font-bold gap-2">
                                    <i class="ph ph-hand-grabbing text-sm md:text-lg"></i> <span class="hidden sm:inline" data-i18n="pan">PAN</span>
                                </button>
                            </div>
                        </div>

                        <!-- Brushes Section -->
                        <div class="space-y-1 md:space-y-2 flex-1">
                             <h3 class="text-[10px] md:text-xs font-bold text-slate-500 uppercase tracking-wider hidden md:block">Brushes</h3>
                             <div class="grid grid-cols-4 md:grid-cols-2 gap-1 md:gap-2 h-full">
                                 <button onclick="Editor.setTool(1)" id="t-1" class="tool-btn h-12 md:h-20 bg-slate-800 hover:bg-slate-700 rounded-lg border-2 border-transparent transition flex flex-col items-center justify-center gap-1 md:gap-2 group">
                                    <div class="icon-wall-preview w-4 h-4 md:w-8 md:h-8 bg-slate-500 border border-slate-400 rounded group-hover:scale-110 transition"></div>
                                    <span class="text-[9px] md:text-xs font-bold text-slate-400 group-hover:text-white hidden md:block" data-i18n="wall">Wall</span>
                                 </button>
                                 <button onclick="Editor.setTool(0)" id="t-0" class="tool-btn h-12 md:h-20 bg-slate-800 hover:bg-slate-700 rounded-lg border-2 border-transparent transition flex flex-col items-center justify-center gap-1 md:gap-2 group">
                                    <div class="icon-path-preview w-4 h-4 md:w-8 md:h-8 bg-slate-950 border border-slate-600 rounded group-hover:scale-110 transition"></div>
                                    <span class="text-[9px] md:text-xs font-bold text-slate-400 group-hover:text-white hidden md:block" data-i18n="path">Path</span>
                                 </button>
                                 <button onclick="Editor.setTool(2)" id="t-2" class="tool-btn h-12 md:h-20 bg-slate-800 hover:bg-slate-700 rounded-lg border-2 border-transparent transition flex flex-col items-center justify-center gap-1 md:gap-2 group">
                                    <div class="w-4 h-4 md:w-8 md:h-8 bg-emerald-500 rounded-full group-hover:scale-110 transition"></div>
                                    <span class="text-[9px] md:text-xs font-bold text-slate-400 group-hover:text-white hidden md:block" data-i18n="start">Start</span>
                                 </button>
                                 <button onclick="Editor.setTool(3)" id="t-3" class="tool-btn h-12 md:h-20 bg-slate-800 hover:bg-slate-700 rounded-lg border-2 border-transparent transition flex flex-col items-center justify-center gap-1 md:gap-2 group">
                                    <div class="w-4 h-4 md:w-8 md:h-8 bg-red-500 rounded-full shadow-[0_0_8px_red] group-hover:scale-110 transition"></div>
                                    <span class="text-[9px] md:text-xs font-bold text-slate-400 group-hover:text-white hidden md:block" data-i18n="end">End</span>
                                 </button>
                             </div>
                        </div>
                    </div>

                    <!-- Divider -->
                    <div class="h-px bg-slate-800 hidden md:block" id="editor-divider"></div>

                    <!-- Group 2: Settings & Gen -->
                    <div class="space-y-2 md:space-y-6 flex flex-col justify-between">
                        <!-- Settings Section -->
                        <div class="space-y-2 md:space-y-4">
                            <h3 class="text-[10px] md:text-xs font-bold text-slate-500 uppercase tracking-wider hidden md:block">Properties</h3>
                            <div class="space-y-1">
                                <div class="flex justify-between text-[10px] md:text-xs text-slate-400">
                                    <span data-i18n="prop_grid">Grid Size</span> <span id="lbl-size" class="font-mono text-cyan-400">10x</span>
                                </div>
                                <input type="range" min="10" max="100" step="5" value="10" onchange="Editor.resize(this.value)" class="w-full accent-cyan-500 h-1 bg-slate-800 rounded-lg appearance-none cursor-pointer">
                            </div>
                            <div class="space-y-1">
                                <div class="flex justify-between text-[10px] md:text-xs text-slate-400">
                                    <span data-i18n="prop_zoom">Zoom Level</span>
                                </div>
                                <input type="range" min="0.5" max="3" step="0.1" value="1" oninput="Editor.setZoom(this.value)" class="w-full accent-cyan-500 h-1 bg-slate-800 rounded-lg appearance-none cursor-pointer">
                            </div>
                        </div>

                        <!-- Generator Section -->
                        <div class="bg-slate-950 p-2 md:p-3 rounded-xl border border-slate-800 space-y-2 md:space-y-3 transition-colors" id="editor-gen-box">
                            <h3 class="text-[10px] md:text-xs font-bold text-slate-500 uppercase tracking-wider flex items-center gap-2"><i class="ph ph-magic-wand"></i> <span class="hidden sm:inline" data-i18n="gen_title">Generator</span></h3>
                            <div class="flex gap-2">
                                <div class="relative flex-1">
                                    <input id="ed-code" type="text" placeholder="SEED" class="w-full bg-slate-900 border border-slate-700 text-white text-[10px] md:text-xs px-2 h-6 md:h-8 rounded uppercase font-mono focus:border-cyan-500 outline-none transition-colors">
                                    <button onclick="Utils.randomCode('ed-code')" class="absolute right-1 top-0.5 text-slate-500 hover:text-white p-1"><i class="ph ph-dice-five"></i></button>
                                </div>
                                <select id="ed-size" class="bg-slate-900 text-slate-300 border border-slate-700 rounded text-[10px] md:text-xs h-6 md:h-8 px-1 w-12 md:w-14 transition-colors">
                                    <option value="11">10x</option>
                                    <option value="25" selected>25x</option>
                                    <option value="51">50x</option>
                                    <option value="101">100x</option>
                                </select>
                            </div>
                            <button onclick="Editor.generateFromCode()" class="w-full bg-cyan-700 hover:bg-cyan-600 text-white text-[10px] md:text-xs h-6 md:h-8 rounded font-bold transition" data-i18n="gen">GEN</button>
                        </div>
                        <button onclick="Editor.clear()" class="w-full border border-red-900/50 text-red-400 hover:bg-red-900/20 py-2 md:py-3 rounded-lg text-[10px] md:text-xs font-bold flex items-center justify-center gap-2 transition">
                            <i class="ph ph-trash text-sm md:text-lg"></i> <span class="hidden sm:inline" data-i18n="clear">CLEAR MAP</span>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Viewport -->
            <div id="editor-viewport" class="flex-1 bg-grid-pattern relative p-4 md:p-8 mode-draw overflow-hidden flex items-center justify-center transition-colors duration-300">
                <div id="editor-grid"></div>
            </div>
        </div>
    </div>

    <!-- Victory Screen -->
    <div id="screen-victory" class="ui-screen hidden bg-black/95 interactive items-center justify-center z-[100] text-center p-6">
        <div class="max-w-sm w-full bg-slate-900 p-8 rounded-3xl border border-yellow-500/20 shadow-2xl transition-colors" id="box-victory">
            <i class="ph ph-crown text-6xl text-yellow-400 mb-4 inline-block animate-bounce"></i>
            <h2 class="text-4xl font-black text-white mb-2" data-i18n="complete" id="victory-title">COMPLETE!</h2>
            <div class="text-2xl font-mono text-cyan-400 font-bold mb-6 bg-slate-950 p-2 rounded-lg border border-slate-800 transition-colors" id="victory-time">00:00</div>
            <button onclick="Game.quit()" class="w-full bg-cyan-600 hover:bg-cyan-500 text-white py-4 rounded-xl font-bold shadow-lg transition" data-i18n="main_menu">Main Menu</button>
        </div>
    </div>

    <!-- Game Over Screen -->
    <div id="screen-gameover" class="ui-screen hidden bg-red-950/90 interactive items-center justify-center z-[100] text-center p-6">
        <div class="max-w-sm w-full bg-slate-900 p-8 rounded-3xl border border-red-500/50 shadow-2xl transition-colors" id="box-gameover">
            <i class="ph ph-skull text-6xl text-red-500 mb-4 inline-block animate-pulse"></i>
            <h2 class="text-4xl font-black text-white mb-2" id="gameover-title">GAME OVER</h2>
            <p class="text-slate-400 mb-6" id="fail-reason">The ghost caught you!</p>
            <button onclick="Game.quit()" class="w-full bg-slate-700 hover:bg-slate-600 text-white py-4 rounded-xl font-bold shadow-lg transition" data-i18n="main_menu">Main Menu</button>
        </div>
    </div>
    
    <script src="script.js"></script>
</body>

</html>

